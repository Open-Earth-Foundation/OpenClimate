# OpenClimate
Independent Climate Accounting Network in support of Paris Agreement goals

A self signed SSL certificate is autogenerated at nginx/ssl/my-site.com.(key|crt). You can provide your own keys here, or modify the scripts to use an alternate key.

One method is to use Let's Encrypt:

https://letsencrypt.org/


First, checkout the repository.

    git clone ...

Then get the git submodules

    git submodule update --init

It can be helpful to go into the following submodule's folders and get the latest commit or switch to the branch you want to work on, such as:

    cd OpenClimate-hub-controller
    git checkout main
    git pull

    cd OpenClimate-hub-ui
    git checkout main
    git pull

If you are setting up the agents in a production environment, create an .env file for each enterprise agent (lab and government) with the following values customized for each (you can put these values in docker-compose-release.yml, but they would be overwritten with every new pull from github):

    WEB_ROOT=https://localhost:port_number_if_necessary
    JWT_SECRET=yoursecrethere (32 alpha-numeric digits, e.g. GGgNz2CVwxBJjhVzHmuKPV3bEJMdViKP)
    SESSION_SECRET=yoursecrethere (32 alpha-numeric digits, e.g. y5YSfodHhp6QkbG3IxaqlzcFQXUlZquh)

The email issuer needs RECAPTCHA keys to work properly. Go to https://www.google.com/recaptcha/admin/create, add a site label, select v.2, and add the proper domain. Fill out the rest of the fields, then copy and paste the keys into the following ENV variables:

    - RECAPTCHA_SITEKEY=6Le3N9Yc12345DtL-f700RBPA312345An6rV69Fy
    - RECAPTCHA_SECRETKEY=6Le3N9Yc12345D2KO8JGJdYr12345jLRlw9WOAh5

We can finally start the docker containers by runnning

    docker-compose up

The first time you bring up the containers and agent(in a container or separate) or reset them, you must run the following script after the controller api containers have started:

    docker-compose exec government-api npm run first-time-setup
    docker-compose exec lab-api npm run first-time-setup

You also want to log in and configure the SMTP settings before you attempt any process that sends emails (such as user creation or email verification). Here are some sample settings:

    Host: smtp.gmail.com
    Email: youremail@gmail.com
    Password: ******

For Gmail-based email accounts, you will need to set up an App Password by going to https://myaccount.google.com/?pli=1, selecting "Security" from the left column links, and then clicking "App Passwords" under "Signing into Google." When selecting the type of app, make sure to use "Other" and to type in a label that helps you remember what the app password was for.

To reset all the containers, you can run:

    docker-compose rm

To remove just one container, you can run something like the following:

    docker-compose rm api

If you change the agent dependencies or version, you must start the docker containers with a --build flag:

    docker-compose up --build

If you want you can run the containers detached by adding the -d command. For more details about docker-compose up, you can run

    docker-compose up --help

If you need to execute commands in one of the running containers, you can run something like the following.

    docker-compose exec db sh

In the previous case we entered the db container and ran the command sh. Tab completion is helpful in seeing the list of containers available.

    $ docker-compose exec
    api        db         ui         webserver
